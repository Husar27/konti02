<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,
initial-scale=1.0" />
  <title>Profil użytkownika</title>
  <style>
            .floating-btn {
                  position: fixed;
                  z-index: 1000;
                  background: rgba(255,255,255,0.7);
                  border: none;
                  box-shadow: 0 2px 8px 0 rgba(0,0,0,0.10);
                  border-radius: 50%;
                  padding: 8px;
                  cursor: pointer;
                  transition: background 0.2s, box-shadow 0.2s;
                  color: #222;
                  outline: none;
                  backdrop-filter: blur(2px);
            }
            .floating-btn svg {
                  display: block;
                  width: 32px;
                  height: 32px;
                  stroke: #222;
                  opacity: 0.85;
            }
            .floating-btn:hover {
                  background: rgba(76,175,80,0.12);
                  box-shadow: 0 4px 16px 0 rgba(76,175,80,0.18);
            }
            .back-btn {
                  top: 24px;
                  right: 24px;
            }
                        @media (max-width: 600px) {
                              .back-btn {
                                    top: 44px;
                                    right: 44px;
                                    left: unset;
                                    bottom: unset;
                              }
                              .floating-btn svg {
                                    width: 28px;
                                    height: 28px;
                              }
                        }
            :root {
                  --bg-light: #f0f0f0;
                  --text-light: #333;
            }
            body {
                  background-color: var(--bg-light);
                  color: var(--text-light);
            }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      transition: background-color 0.3s, color 0.3s;
    }

    .profile-container {
      max-width: 500px;
      margin: auto;
      padding: 2rem;
      border-radius: 10px;
      background-color: inherit;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

            /* usunięto dark mode */

    .profile-form button {
      display: block;
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.7rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .panel {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: rgba(0,0,0,0.03);
    }

    input, textarea, select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-bottom: 1rem;
    }

    .vacation-info, .birthday-list {
      font-style: italic;
      margin-top: 0.5rem;
    }

    .birthday-entry {
      margin-top: 0.3rem;
    }

            /* Wszystkie przyciski na zielono, Wyloguj się na szaro */
            #saveEmailBtn, #saveLanguageBtn,
            #toggleEmailPanel, #toggleVacationPanel, #toggleBirthdayPanel,
            #togglePasswordPanel, #toggleLanguagePanel,
            #saveVacationBtn, #addBirthdayBtn, #changePasswordBtn,
            #cancelVacationBtn {
                  background-color: #4CAF50;
                  color: white;
            }
            #logoutBtn {
                  background-color: #757575;
                  color: white;
            }
  </style>
</head>
<body>
                  <script>
                        // Sprawdź czy użytkownik jest zalogowany
                        if (!sessionStorage.getItem("login")) {
                              window.location.href = "index.html";
                        }
                  </script>
                  <button id="backBtn" title="Powrót do kalendarza" class="floating-btn back-btn" aria-label="Powrót do kalendarza">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="4" y="5" width="16" height="15" rx="3"/>
                  <line x1="8" y1="3" x2="8" y2="7"/>
                  <line x1="16" y1="3" x2="16" y2="7"/>
                  <line x1="4" y1="10" x2="20" y2="10"/>
            </svg>
      </button>
      <div class="profile-container">
            <header>
                  <h2 id="usernameLabel">Witaj, <span id="username">Mariusz</span></h2>

            </header>

    <section class="profile-form">
                  <button id="toggleShiftPanel" style="background-color: #4CAF50; color: white;">Wybierz system zmian</button>
                  <div id="shiftPanel" class="panel">
                                          <label id="labelShiftSystem">System zmian:</label>
                                          <select id="shiftSystemSelect">
                                                <option value="4">4-zmianowy</option>
                                                <option value="3">3-zmianowy</option>
                                          </select>
                                          <div id="shiftTypePanel" style="margin-top:10px;">
                                                <label id="labelShiftType">Wybierz zmianę:</label>
                                                <select id="shiftTypeSelect"></select>
                                          </div>
                                          <button id="saveShiftSystemBtn">Zapisz system</button>
                  </div>
      <button id="changeLanguageBtn">Zmień język</button>

      <button id="toggleVacationPanel">Zarządzaj urlopem</button>
      <div id="vacationPanel" class="panel">
      <label id="labelVacationStart">Od:</label>
      <input type="date" id="vacationStart" />
      <label id="labelVacationEnd">Do:</label>
      <input type="date" id="vacationEnd" />
      <button id="saveVacationBtn">Zapisz urlop</button>
      <button id="cancelVacationBtn" style="display:none;">Anuluj urlop</button>
      <div class="vacation-info" id="vacationInfo"></div>
      </div>

      <button id="toggleBirthdayPanel">Zarządzaj urodzinami</button>
      <div id="birthdayPanel" class="panel">
      <label id="labelFriendName">Imię:</label>
      <input type="text" id="friendName" placeholder="Imię znajomego" />
      <label id="labelFriendBirthday">Data urodzin:</label>
      <input type="date" id="friendBirthday" />
      <button id="addBirthdayBtn">Dodaj urodziny</button>
      <div class="birthday-list" id="birthdayList"></div>
      </div>

      <button id="togglePasswordPanel">Zmień hasło</button>
      <div id="passwordPanel" class="panel">
      <label id="labelOldPassword">Stare hasło:</label>
      <input type="password" id="oldPassword" />
      <label id="labelNewPassword">Nowe hasło:</label>
      <input type="password" id="newPassword" />
      <button id="changePasswordBtn">Zapisz nowe hasło</button>
      </div>

      <button id="logoutBtn">Wyloguj się</button>
    </section>
  </div>

  <script>
            // Nawigacja: powrót do kalendarza i wylogowanie
            document.getElementById("backBtn").addEventListener("click", function() {
                  window.location.href = "calendar.html";
            });
            // Wylogowanie: czyści dane użytkownika i przekierowuje do index.html
            document.getElementById("logoutBtn").addEventListener("click", function() {
                  // Usuń dane użytkownika z localStorage i sessionStorage
                  localStorage.removeItem("userLanguage");
                  localStorage.removeItem("userEmail");
                  localStorage.removeItem("userVacation");
                  localStorage.removeItem("userBirthdays");
                  sessionStorage.removeItem("login");
                  sessionStorage.removeItem("guest");
                  window.location.href = "index.html";
            });
                                    window.addEventListener("DOMContentLoaded", () => {
                                          // Język
                                          let lang = localStorage.getItem("userLanguage") || "de";
                                          document.getElementById("languageSelect").value = lang;
                                          applyLanguage(lang);

                                          // System zmian
                                          const savedSystem = localStorage.getItem("userShiftSystem") || "4";
                                          shiftSystemSelect.value = savedSystem;
                                          updateShiftTypeOptions();
                                          const savedType = localStorage.getItem("userShiftType") || "A";
                                          shiftTypeSelect.value = savedType;

                                          // Urlop
                                          const vacation = JSON.parse(localStorage.getItem("userVacation"));
                                          if (vacation) {
                                                document.getElementById("vacationInfo").textContent = `Twój urlop: ${vacation.start} → ${vacation.end}`;
                                                document.getElementById("cancelVacationBtn").style.display = "inline-block";
                                          }

                                          // Urodziny
                                          const birthdays = JSON.parse(localStorage.getItem("userBirthdays")) || [];
                                          updateBirthdayList(birthdays);
                                    });
function togglePanel(id) {
  document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
  const panel = document.getElementById(id);
  if (panel) panel.style.display = 'block';
}

document.getElementById("toggleLanguagePanel").addEventListener("click", () => togglePanel("languagePanel"));
document.getElementById("toggleShiftPanel").addEventListener("click", () => togglePanel("shiftPanel"));
document.getElementById("toggleVacationPanel").addEventListener("click", () => togglePanel("vacationPanel"));
document.getElementById("toggleBirthdayPanel").addEventListener("click", () => togglePanel("birthdayPanel"));
document.getElementById("togglePasswordPanel").addEventListener("click", () => togglePanel("passwordPanel"));

// Dynamiczne opcje zmiany w zależności od systemu
const shiftTypeSelect = document.getElementById("shiftTypeSelect");
const shiftSystemSelect = document.getElementById("shiftSystemSelect");
function updateShiftTypeOptions() {
  const system = shiftSystemSelect.value;
  shiftTypeSelect.innerHTML = "";
  const types = system === "4" ? ["A", "B", "C", "D"] : ["A", "B", "C"];
  types.forEach(val => {
    const opt = document.createElement("option");
    opt.value = val;
    opt.textContent = val;
    shiftTypeSelect.appendChild(opt);
  });
}
shiftSystemSelect.addEventListener("change", () => {
  updateShiftTypeOptions();
  shiftTypeSelect.value = shiftTypeSelect.options[0].value;
});

document.getElementById("saveShiftSystemBtn").addEventListener("click", () => {
      const system = shiftSystemSelect.value;
      const shift = shiftTypeSelect.value;
      localStorage.setItem("userShiftSystem", system);
      localStorage.setItem("userShiftType", shift);
      alert("System zmian i zmiana zostały zapisane na stałe.");
      document.getElementById("shiftPanel").style.display = "none";
});

// Ustaw domyślny wybór na podstawie zapisanego wyboru
// ...usunięto powielony DOMContentLoaded...
document.getElementById("saveEmailBtn").addEventListener("click",
() => {
      const email = document.getElementById("email").value;
      if (!email) return alert("Wprowadź adres email.");
      localStorage.setItem("userEmail", email);
      alert("Email zapisany.");
      document.getElementById("emailPanel").style.display =
"none";
    });

   
document.getElementById("saveVacationBtn").addEventListener("click",
() => {
      const start = document.getElementById("vacationStart").value;
      const end = document.getElementById("vacationEnd").value;
      if (!start || !end || start > end) return alert("Wprowadź poprawny zakres dat.");
      const vacation = { start, end };
      localStorage.setItem("userVacation",
JSON.stringify(vacation));
      document.getElementById("vacationInfo").textContent =
`Twój urlop: ${start} → ${end}`;
      document.getElementById("cancelVacationBtn").style.display
= "inline-block";
      alert("Urlop zapisany.");
    });

   
document.getElementById("cancelVacationBtn").addEventListener("click",
() => {
      localStorage.removeItem("userVacation");
      document.getElementById("vacationInfo").textContent =
"";
      document.getElementById("cancelVacationBtn").style.display
= "none";
      alert("Urlop anulowany.");
    });

   
document.getElementById("addBirthdayBtn").addEventListener("click",
() => {
      const name = document.getElementById("friendName").value.trim();
      const date = document.getElementById("friendBirthday").value;
      if (!name || !date) return alert("Wprowadź imię i datę urodzin.");
      const birthdays = JSON.parse(localStorage.getItem("userBirthdays")) || [];
      birthdays.push({ name, date });
      localStorage.setItem("userBirthdays",
JSON.stringify(birthdays));
      updateBirthdayList(birthdays);
      document.getElementById("friendName").value = "";
      document.getElementById("friendBirthday").value =
"";
      alert("Urodziny dodane.");
    });


            function updateBirthdayList(birthdays) {
                  const list = document.getElementById("birthdayList");
                  list.innerHTML = "";
                  birthdays.forEach((entry) => {
                        const div = document.createElement("div");
                        div.className = "birthday-entry";
                        div.textContent = `${entry.name} – ${entry.date}`;
                        list.appendChild(div);
                  });
            }

document.getElementById("changePasswordBtn").addEventListener("click", () => {
      const oldPass = document.getElementById("oldPassword").value;
      const newPass = document.getElementById("newPassword").value;
      if (!oldPass || !newPass) return alert("Wprowadź oba hasła.");
      // Tu powinna być logika sprawdzania i zapisu hasła
      alert("Hasło zostało zmienione.");
      document.getElementById("oldPassword").value = "";
      document.getElementById("newPassword").value = "";
      document.getElementById("passwordPanel").style.display = "none";
});

// Obsługa cyklicznej zmiany języka
document.getElementById("changeLanguageBtn").addEventListener("click", () => {
      const langs = ["de", "pl", "ru"];
      let current = localStorage.getItem("userLanguage") || "de";
      let idx = langs.indexOf(current);
      let next = langs[(idx + 1) % langs.length];
      localStorage.setItem("userLanguage", next);
      sessionStorage.setItem("userLanguage", next);
      applyLanguage(next);
});

// Inicjalizacja języka przy starcie


   
document.getElementById("saveLanguageBtn").addEventListener("click", () => {
      const lang = document.getElementById("languageSelect").value;
      localStorage.setItem("userLanguage", lang);
      sessionStorage.setItem("userLanguage", lang);
      document.getElementById("languagePanel").style.display = "none";
      applyLanguage(lang);
});

            function applyLanguage(lang) {
                  const t = {
                        pl: {
                              usernameLabel: "Witaj,",
          toggleEmailPanel: "Zmień email",
          toggleVacationPanel: "Zarządzaj urlopem",
          toggleBirthdayPanel: "Zarządzaj urodzinami",
          togglePasswordPanel: "Zmień hasło",
          toggleLanguagePanel: "Zmień język",
          logoutBtn: "Wyloguj się",
          saveEmailBtn: "Zapisz email",
          saveVacationBtn: "Zapisz urlop",
          cancelVacationBtn: "Anuluj urlop",
          addBirthdayBtn: "Dodaj urodziny",
          changePasswordBtn: "Zapisz nowe hasło",
          saveLanguageBtn: "Zapisz język",
          labelLanguage: "Wybierz język:",
          labelEmail: "Email:",
          labelVacationStart: "Od:",
          labelVacationEnd: "Do:",
          labelFriendName: "Imię:",
          labelFriendBirthday: "Data urodzin:",
          labelOldPassword: "Stare hasło:",
          labelNewPassword: "Nowe hasło:"
        },
        de: {
          usernameLabel: "Willkommen,",
          toggleEmailPanel: "E-Mail ändern",
          toggleVacationPanel: "Urlaub verwalten",
          toggleBirthdayPanel: "Geburtstage verwalten",
          togglePasswordPanel: "Passwort ändern",
          toggleLanguagePanel: "Sprache ändern",
          logoutBtn: "Abmelden",
          saveEmailBtn: "E-Mail speichern",
          saveVacationBtn: "Urlaub speichern",
          cancelVacationBtn: "Urlaub löschen",
          addBirthdayBtn: "Geburtstag hinzufügen",
          changePasswordBtn: "Passwort speichern",
          saveLanguageBtn: "Sprache speichern",
          labelLanguage: "Sprache wählen:",
          labelEmail: "E-Mail:",
          labelVacationStart: "Von:",
          labelVacationEnd: "Bis:",
          labelFriendName: "Name:",
          labelFriendBirthday: "Geburtstag:",
          labelOldPassword: "Altes Passwort:",
          labelNewPassword: "Neues Passwort:"
        },
        ru: {
          usernameLabel: "Добро пожаловать,",
          toggleEmailPanel: "Изменить email",
          toggleVacationPanel: "Управление отпуском",
          toggleBirthdayPanel: "Дни рождения друзей",
          togglePasswordPanel: "Сменить пароль",
          toggleLanguagePanel: "Изменить язык",
          logoutBtn: "Выйти",
          saveEmailBtn: "Сохранить email",
          saveVacationBtn: "Сохранить отпуск",
          cancelVacationBtn: "Удалить отпуск",
          addBirthdayBtn: "Добавить день рождения",
          changePasswordBtn: "Сохранить пароль",
          saveLanguageBtn: "Сохранить язык",
          labelLanguage: "Выберите язык:",
          labelEmail: "Email:",
          labelVacationStart: "С:",
          labelVacationEnd: "По:",
          labelFriendName: "Имя:",
          labelFriendBirthday: "Дата рождения:",
          labelOldPassword: "Старый пароль:",
          labelNewPassword: "Новый пароль:"
        }
      };

      const tr = t[lang];
      // Pobierz login z sessionStorage
      const login = sessionStorage.getItem("login") || "";
      const setText = (id, text) => {
        const el = document.getElementById(id);
        if (el) el.innerText = text;
      };
      setText("usernameLabel", `${tr.usernameLabel} ${login}`);
      setText("toggleEmailPanel", tr.toggleEmailPanel);
      setText("toggleVacationPanel", tr.toggleVacationPanel);
      setText("toggleBirthdayPanel", tr.toggleBirthdayPanel);
      setText("togglePasswordPanel", tr.togglePasswordPanel);
      setText("toggleLanguagePanel", tr.toggleLanguagePanel);
      setText("logoutBtn", tr.logoutBtn);
      setText("saveEmailBtn", tr.saveEmailBtn);
      setText("saveVacationBtn", tr.saveVacationBtn);
      setText("cancelVacationBtn", tr.cancelVacationBtn);
      setText("addBirthdayBtn", tr.addBirthdayBtn);
      setText("changePasswordBtn", tr.changePasswordBtn);
      // usunięto obsługę nieistniejących już elementów wyboru języka
      setText("labelEmail", tr.labelEmail);
      setText("labelVacationStart", tr.labelVacationStart);
      setText("labelVacationEnd", tr.labelVacationEnd);
      setText("labelFriendName", tr.labelFriendName);
      setText("labelFriendBirthday", tr.labelFriendBirthday);
      setText("labelOldPassword", tr.labelOldPassword);
      setText("labelNewPassword", tr.labelNewPassword);
    }
  </script>
</body>
</html>
